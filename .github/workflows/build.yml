name: Test and build artifacts on release

on: [pull_request, push]

jobs:
    build_apk:
        name: Build release artifacts
        runs-on: ubuntu-20.04
        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-java@v1
              with: {java-version: 1.8}
            - name: Grant execute permission for gradlew
              run: chmod +x gradlew
            - name: Build release APK after test
              run: |
                  ./gradlew test
                  ./gradlew assembleRelease
                  ./gradlew bundleRelease
            - name: Upload APK
              uses: actions/upload-artifact@v2
              with:
                  name: app-release.apk
                  path: app/build/outputs/apk/release/app-release-unsigned.apk